<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Admin Panel ‚Äî Inspektorat Kab. Tanjung Jabung Timur</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --navy:#1B3A5C;--navy2:#152D48;--navy3:#0E1F33;
  --merah:#C0392B;--emas:#D97706;--emas2:#F59E0B;
  --hijau:#16A34A;--biru:#2563EB;--ungu:#7C3AED;
  --bg:#EEF2F7;--white:#fff;
  --teks:#1C2833;--teks2:#374151;--teks3:#6B7280;
  --border:#E5E7EB;--border2:#D1D5DB;
  --sh:0 2px 8px rgba(0,0,0,.08);--sh2:0 8px 32px rgba(0,0,0,.14);
  --sw:264px;
}
body{font-family:"Sora",sans-serif;background:var(--bg);color:var(--teks);min-height:100vh;}

/* LOGIN */
#loginPage{position:fixed;inset:0;z-index:9999;background:linear-gradient(145deg,var(--navy3),var(--navy) 55%,#1a4a7a);display:flex;align-items:center;justify-content:center;padding:20px;}
#loginPage::before{content:"";position:absolute;inset:0;pointer-events:none;
  background:radial-gradient(ellipse 60% 50% at 15% 30%,rgba(212,160,23,.14) 0%,transparent 60%),
  radial-gradient(ellipse 50% 60% at 85% 70%,rgba(192,57,43,.10) 0%,transparent 60%);}
.lw{position:relative;display:flex;max-width:880px;width:100%;border-radius:22px;overflow:hidden;box-shadow:0 40px 100px rgba(0,0,0,.5);animation:lPop .55s cubic-bezier(.34,1.56,.64,1);}
@keyframes lPop{from{transform:scale(.88) translateY(30px);opacity:0}to{transform:scale(1) translateY(0);opacity:1}}
.ll{flex:1;background:linear-gradient(165deg,var(--navy2),var(--navy3));padding:48px 40px;display:flex;flex-direction:column;justify-content:center;}
.ll-badge{width:70px;height:70px;background:linear-gradient(135deg,var(--emas),var(--emas2));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:22px;box-shadow:0 8px 28px rgba(212,160,23,.4);}
.ll h1{font-family:"Playfair Display",serif;font-size:1.65rem;color:#fff;font-weight:700;line-height:1.3;margin-bottom:8px;}
.ll p{font-size:.8rem;color:rgba(255,255,255,.5);line-height:1.8;}
.ll-feats{margin-top:28px;display:flex;flex-direction:column;gap:9px;}
.lf{display:flex;align-items:center;gap:10px;font-size:.77rem;color:rgba(255,255,255,.6);}
.lf-dot{width:6px;height:6px;border-radius:50%;background:var(--emas2);flex-shrink:0;}
.lr{width:370px;flex-shrink:0;background:#fff;padding:48px 38px;}
.lr h2{font-family:"Playfair Display",serif;font-size:1.25rem;color:var(--navy);margin-bottom:5px;}
.lr-sub{font-size:.77rem;color:var(--teks3);margin-bottom:26px;}
.fg{margin-bottom:15px;}
.fg label{display:block;font-size:.7rem;font-weight:700;color:var(--teks2);letter-spacing:.8px;text-transform:uppercase;margin-bottom:6px;}
.fg .fw{position:relative;}
.fg input{width:100%;padding:11px 14px 11px 38px;border:1.5px solid var(--border2);border-radius:10px;font-family:"Sora",sans-serif;font-size:.86rem;color:var(--teks);background:#FAFAFA;outline:none;transition:all .2s;}
.fg input:focus{border-color:var(--navy);background:#fff;box-shadow:0 0 0 3px rgba(27,58,92,.1);}
.fi{position:absolute;left:11px;top:50%;transform:translateY(-50%);font-size:14px;color:var(--teks3);}
.fe{position:absolute;right:11px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:14px;color:var(--teks3);}
.frem{display:flex;align-items:center;gap:8px;margin-bottom:18px;}
.frem input{width:15px;height:15px;accent-color:var(--navy);cursor:pointer;}
.frem label{font-size:.77rem;color:var(--teks2);cursor:pointer;}
.lbtn{width:100%;padding:12px;background:linear-gradient(135deg,var(--navy),var(--navy2));color:#fff;border:none;border-radius:10px;font-family:"Sora",sans-serif;font-size:.88rem;font-weight:600;cursor:pointer;box-shadow:0 4px 16px rgba(27,58,92,.35);transition:all .2s;}
.lbtn:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(27,58,92,.45);}
.lbtn:disabled{opacity:.55;cursor:not-allowed;transform:none;}
.lerr{background:#FEE2E2;border:1px solid #FECACA;border-radius:8px;padding:9px 14px;font-size:.78rem;color:#991B1B;margin-top:12px;display:none;text-align:center;font-weight:500;}
.lerr.show{display:block;animation:shake .3s ease;}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.lattempt{font-size:.72rem;color:var(--merah);margin-top:7px;text-align:center;display:none;}
.lattempt.show{display:block;}
.llock{display:none;text-align:center;padding:12px 0;}
.llock.show{display:block;}
.llock .lic{font-size:2.6rem;margin-bottom:8px;}
.llock h3{color:var(--merah);font-size:.95rem;}
.ltimer{font-size:1.4rem;font-weight:700;color:var(--merah);margin:8px 0;}
.ldiv{height:1px;background:linear-gradient(90deg,transparent,var(--border2),transparent);margin:18px 0;}
.lhint{font-size:.72rem;color:var(--teks3);text-align:center;}
@media(max-width:680px){.ll{display:none;}.lr{width:100%;border-radius:20px;}.lw{border-radius:20px;}}

/* LAYOUT */
#adminApp{display:none;}
#adminApp.show{display:flex;min-height:100vh;}

/* SIDEBAR */
.sidebar{width:var(--sw);flex-shrink:0;background:linear-gradient(180deg,var(--navy3),var(--navy2) 55%,var(--navy));position:fixed;top:0;left:0;bottom:0;z-index:200;display:flex;flex-direction:column;box-shadow:4px 0 20px rgba(0,0,0,.22);}
.sl{padding:20px 18px 16px;border-bottom:1px solid rgba(255,255,255,.07);display:flex;align-items:center;gap:12px;}
.sl-ico{width:40px;height:40px;background:linear-gradient(135deg,var(--emas),var(--emas2));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;box-shadow:0 4px 12px rgba(212,160,23,.4);}
.sl h2{font-family:"Playfair Display",serif;font-size:.84rem;color:#fff;font-weight:700;line-height:1.3;}
.sl p{font-size:.6rem;color:rgba(255,255,255,.35);letter-spacing:1.5px;text-transform:uppercase;margin-top:2px;}
.snav{flex:1;padding:12px 10px;overflow-y:auto;}
.nsec{font-size:.58rem;font-weight:700;color:rgba(255,255,255,.25);letter-spacing:2.5px;text-transform:uppercase;padding:11px 10px 4px;}
.ni{display:flex;align-items:center;gap:9px;padding:8px 12px;border-radius:9px;font-size:.8rem;font-weight:500;color:rgba(255,255,255,.58);cursor:pointer;transition:all .2s;margin-bottom:1px;user-select:none;}
.ni:hover{background:rgba(255,255,255,.07);color:#fff;}
.ni.active{background:rgba(212,160,23,.18);color:var(--emas2);border:1px solid rgba(212,160,23,.25);}
.ni .nico{font-size:.9rem;width:18px;text-align:center;flex-shrink:0;}
.nb{margin-left:auto;font-size:.6rem;font-weight:700;padding:2px 7px;border-radius:10px;background:var(--merah);color:#fff;}
.nb.g{background:var(--hijau)!important;}
.nb.b{background:var(--biru)!important;}
.nb.o{background:var(--emas)!important;}
.sfoot{padding:12px 12px;border-top:1px solid rgba(255,255,255,.07);}
.uc{background:rgba(255,255,255,.06);border-radius:10px;padding:9px 11px;display:flex;align-items:center;gap:9px;}
.uav{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--emas),var(--emas2));display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0;}
.un{font-size:.78rem;font-weight:600;color:#fff;}
.ur{font-size:.63rem;color:rgba(255,255,255,.35);}
.uout{margin-left:auto;cursor:pointer;font-size:15px;color:rgba(255,255,255,.3);transition:color .2s;}
.uout:hover{color:#F87171;}

/* MAIN */
.main{margin-left:var(--sw);flex:1;display:flex;flex-direction:column;}
.topbar{position:sticky;top:0;z-index:100;height:60px;background:rgba(255,255,255,.96);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);padding:0 26px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 8px rgba(0,0,0,.06);}
.tbl{font-family:"Playfair Display",serif;font-size:1.05rem;color:var(--navy);font-weight:700;}
.tbr{display:flex;align-items:center;gap:9px;}
.tbdate{font-size:.73rem;color:var(--teks3);padding:5px 11px;background:#F4F6F9;border-radius:7px;}
.tbbtn{display:flex;align-items:center;gap:5px;padding:6px 13px;border-radius:8px;border:none;font-family:"Sora",sans-serif;font-size:.74rem;font-weight:600;cursor:pointer;transition:all .2s;}
.tbbtn.navy{background:var(--navy);color:#fff;}
.tbbtn.navy:hover{background:var(--navy2);}
.tbbtn.green{background:var(--hijau);color:#fff;}
.tbbtn.green:hover{background:#138a3a;}
.tbnotif{position:relative;cursor:pointer;padding:6px 9px;border-radius:8px;background:#F4F6F9;font-size:15px;transition:background .2s;}
.tbnotif:hover{background:var(--border);}
.ndot{position:absolute;top:5px;right:6px;width:7px;height:7px;background:var(--merah);border-radius:50%;border:2px solid #fff;}

.content{padding:22px 26px 44px;}
.panel{display:none;}
.panel.active{display:block;animation:fup .3s ease;}
@keyframes fup{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* STAT GRID */
.sg{display:grid;grid-template-columns:repeat(6,1fr);gap:13px;margin-bottom:20px;}
.sc{background:#fff;border-radius:13px;padding:16px 14px;border:1px solid var(--border);box-shadow:var(--sh);position:relative;overflow:hidden;transition:transform .2s,box-shadow .2s;cursor:default;}
.sc:hover{transform:translateY(-3px);box-shadow:var(--sh2);}
.sc::after{content:"";position:absolute;top:0;left:0;right:0;height:3px;border-radius:13px 13px 0 0;}
.c1::after{background:linear-gradient(90deg,var(--navy),#3B82F6);}
.c2::after{background:linear-gradient(90deg,var(--emas),var(--emas2));}
.c3::after{background:linear-gradient(90deg,var(--biru),#60A5FA);}
.c4::after{background:linear-gradient(90deg,var(--ungu),#A78BFA);}
.c5::after{background:linear-gradient(90deg,var(--hijau),#34D399);}
.c6::after{background:linear-gradient(90deg,var(--merah),#F87171);}
.sc-ico{font-size:1.4rem;margin-bottom:9px;display:block;}
.sc-val{font-family:"Playfair Display",serif;font-size:1.85rem;font-weight:700;color:var(--navy);line-height:1;}
.sc-lbl{font-size:.65rem;color:var(--teks3);margin-top:5px;font-weight:600;letter-spacing:.8px;text-transform:uppercase;}
.sc-sub{font-size:.64rem;margin-top:5px;color:var(--teks3);}

/* GRAFIK */
.gr{display:grid;gap:15px;margin-bottom:18px;}
.gr.g31{grid-template-columns:2fr 1fr;}
.gr.g22{grid-template-columns:1fr 1fr;}
.gr.g11{grid-template-columns:1fr;}
.gc{background:#fff;border-radius:13px;border:1px solid var(--border);padding:18px;box-shadow:var(--sh);}
.gch{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.gch h4{font-size:.76rem;font-weight:700;color:var(--teks2);text-transform:uppercase;letter-spacing:.8px;}
.gch .gt{font-size:.66rem;background:#F3F4F6;color:var(--teks3);padding:3px 9px;border-radius:18px;}
/* donut */
.dw{display:flex;align-items:center;justify-content:center;gap:18px;flex-wrap:wrap;padding:4px 0;}
.dleg{display:flex;flex-direction:column;gap:8px;}
.dli{display:flex;align-items:center;gap:7px;font-size:.73rem;}
.dld{width:10px;height:10px;border-radius:3px;flex-shrink:0;}
.dll{color:var(--teks2);font-weight:500;}
.dlc{margin-left:auto;font-weight:700;color:var(--navy);font-size:.78rem;}
/* hbar */
.hbl{display:flex;flex-direction:column;gap:8px;}
.hbi{display:flex;align-items:center;gap:9px;}
.hbl-lbl{font-size:.7rem;color:var(--teks2);width:145px;flex-shrink:0;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.hbt{flex:1;height:8px;background:#F1F5F9;border-radius:4px;overflow:hidden;}
.hbf{height:100%;border-radius:4px;transition:width .9s cubic-bezier(.4,0,.2,1);}
.hbc{font-size:.7rem;font-weight:700;color:var(--navy);width:20px;text-align:right;flex-shrink:0;}
/* bar vertikal */
.bvw{display:flex;align-items:flex-end;gap:6px;height:130px;padding-bottom:22px;position:relative;}
.bvw::after{content:"";position:absolute;bottom:22px;left:0;right:0;height:1px;background:var(--border);}
.bvi{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;position:relative;}
.bvb{width:100%;border-radius:5px 5px 0 0;transition:height .8s cubic-bezier(.4,0,.2,1);cursor:pointer;min-height:3px;}
.bvb:hover{opacity:.78;}
.bvl{font-size:.56rem;color:var(--teks3);text-align:center;position:absolute;bottom:0;white-space:nowrap;}
.bvv{font-size:.62rem;font-weight:700;color:var(--navy);margin-bottom:3px;}
/* quick stats */
.qs{display:flex;flex-direction:column;gap:9px;}
.qsi{display:flex;align-items:center;gap:11px;padding:9px 12px;background:#F7F9FC;border-radius:9px;}
.qsi-lbl{font-size:.65rem;color:var(--teks3);font-weight:600;text-transform:uppercase;letter-spacing:.6px;}
.qsi-val{font-size:.86rem;font-weight:700;margin-top:2px;}

/* TABLE CARD */
.tc{background:#fff;border-radius:13px;border:1px solid var(--border);box-shadow:var(--sh);overflow:hidden;margin-bottom:16px;}
.tch{padding:13px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:9px;}
.tch h3{font-family:"Playfair Display",serif;font-size:.9rem;color:var(--navy);}
.tcc{display:flex;align-items:center;gap:7px;flex-wrap:wrap;}
.fc-w{position:relative;}
.fc-w::before{content:"üîç";position:absolute;left:9px;top:50%;transform:translateY(-50%);font-size:10px;pointer-events:none;}
.fci{padding:6px 11px 6px 28px;border:1.5px solid var(--border2);border-radius:7px;font-family:"Sora",sans-serif;font-size:.76rem;color:var(--teks);outline:none;transition:border-color .2s;width:188px;}
.fci:focus{border-color:var(--navy);}
.fcs{padding:6px 26px 6px 9px;border:1.5px solid var(--border2);border-radius:7px;font-family:"Sora",sans-serif;font-size:.76rem;color:var(--teks);outline:none;appearance:none;background:#fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%236B7280' fill='none' stroke-width='1.5'/%3E%3C/svg%3E") no-repeat right 8px center;transition:border-color .2s;}
.fcs:focus{border-color:var(--navy);}
.tw{overflow-x:auto;}
table{width:100%;border-collapse:collapse;}
thead th{background:#F8FAFC;border-bottom:2px solid var(--border);padding:9px 13px;text-align:left;font-size:.66rem;font-weight:700;color:var(--teks2);text-transform:uppercase;letter-spacing:.8px;white-space:nowrap;}
thead th.srt{cursor:pointer;user-select:none;}
thead th.srt:hover{background:#EDF0F5;}
tbody tr{border-bottom:1px solid var(--border);transition:background .15s;}
tbody tr:hover{background:#F7FAFF;}
tbody td{padding:10px 13px;font-size:.8rem;color:var(--teks);vertical-align:middle;}
td.mu{color:var(--teks3);font-size:.72rem;}
td.kd{font-family:monospace;font-weight:700;color:var(--navy);font-size:.78rem;}
.badge{display:inline-flex;align-items:center;gap:3px;padding:3px 9px;border-radius:11px;font-size:.66rem;font-weight:700;}
.bd{background:#FEF3C7;color:#92400E;}
.bv{background:#DBEAFE;color:#1E40AF;}
.bp{background:#EDE9FE;color:#5B21B6;}
.bi{background:#FCE7F3;color:#9D174D;}
.bs{background:#D1FAE5;color:#065F46;}
.bt{background:#FEE2E2;color:#991B1B;}
.ab{padding:4px 10px;border-radius:6px;border:none;cursor:pointer;font-family:"Sora",sans-serif;font-size:.68rem;font-weight:600;transition:all .2s;}
.ab-d{background:#EFF6FF;color:#1D4ED8;}.ab-d:hover{background:#DBEAFE;}
.ab-u{background:#FEF9EE;color:#92400E;}.ab-u:hover{background:#FEF3C7;}
.ab-h{background:#FEE2E2;color:#991B1B;}.ab-h:hover{background:#FECACA;}
/* pagination */
.pg{display:flex;align-items:center;justify-content:space-between;padding:10px 18px;border-top:1px solid var(--border);font-size:.72rem;color:var(--teks3);}
.pgb{display:flex;gap:4px;}
.pb{padding:4px 9px;border:1.5px solid var(--border2);border-radius:6px;background:#fff;font-family:"Sora",sans-serif;font-size:.7rem;cursor:pointer;transition:all .2s;}
.pb:hover{border-color:var(--navy);color:var(--navy);}
.pb.active{background:var(--navy);color:#fff;border-color:var(--navy);}
.pb:disabled{opacity:.4;cursor:not-allowed;}

/* MODAL */
.ov{position:fixed;inset:0;z-index:8000;background:rgba(14,31,51,.78);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;padding:20px;}
.ov.show{display:flex;animation:ofade .2s ease;}
@keyframes ofade{from{opacity:0}to{opacity:1}}
.mod{background:#fff;border-radius:17px;width:100%;box-shadow:0 40px 80px rgba(0,0,0,.35);animation:mpop .32s cubic-bezier(.34,1.56,.64,1);overflow:hidden;max-height:90vh;display:flex;flex-direction:column;}
@keyframes mpop{from{transform:scale(.86);opacity:0}to{transform:scale(1);opacity:1}}
.mod.sm{max-width:420px;}.mod.md{max-width:560px;}.mod.lg{max-width:700px;}
.mh{background:linear-gradient(135deg,var(--navy),var(--navy2));padding:14px 20px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.mh h3{font-family:"Playfair Display",serif;font-size:.92rem;color:#fff;}
.mh-sub{font-size:.66rem;color:rgba(255,255,255,.5);margin-top:2px;}
.mhx{cursor:pointer;color:rgba(255,255,255,.5);font-size:17px;transition:color .2s;line-height:1;}
.mhx:hover{color:#fff;}
.mb{padding:20px;overflow-y:auto;flex:1;}
.mf{padding:13px 20px;border-top:1px solid var(--border);display:flex;gap:9px;justify-content:flex-end;flex-shrink:0;}
.mbtn{padding:8px 18px;border-radius:8px;font-family:"Sora",sans-serif;font-size:.8rem;font-weight:600;cursor:pointer;border:none;transition:all .2s;}
.mbtn.ca{background:#F3F4F6;color:var(--teks2);}.mbtn.ca:hover{background:var(--border);}
.mbtn.pr{background:linear-gradient(135deg,var(--navy),var(--navy2));color:#fff;box-shadow:0 3px 12px rgba(27,58,92,.3);}.mbtn.pr:hover{transform:translateY(-1px);}
.mbtn.da{background:linear-gradient(135deg,var(--merah),#A93226);color:#fff;}
.mbtn.su{background:linear-gradient(135deg,var(--hijau),#138a3a);color:#fff;}
/* detail */
.dr{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;}
.dr.f{grid-template-columns:1fr;}
.di label{font-size:.63rem;font-weight:700;color:var(--teks3);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:4px;}
.di p{font-size:.82rem;color:var(--teks);font-weight:500;line-height:1.6;}
.di .db{background:#F8FAFC;border:1px solid var(--border);border-radius:7px;padding:9px 11px;font-size:.78rem;line-height:1.7;max-height:110px;overflow-y:auto;}
.mdiv{height:1px;background:var(--border);margin:12px 0;}
/* form fields modal */
.mfg{margin-bottom:12px;}
.mfg label{display:block;font-size:.66rem;font-weight:700;color:var(--teks2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:5px;}
.mfg input,.mfg select,.mfg textarea{width:100%;padding:9px 12px;border:1.5px solid var(--border2);border-radius:8px;font-family:"Sora",sans-serif;font-size:.82rem;color:var(--teks);outline:none;transition:border-color .2s;background:#fff;}
.mfg input:focus,.mfg select:focus,.mfg textarea:focus{border-color:var(--navy);}
.mfg textarea{resize:vertical;min-height:74px;line-height:1.6;}

/* NOTIF LIST */
.nl{display:flex;flex-direction:column;gap:9px;}
.nli{background:#fff;border-radius:11px;border:1px solid var(--border);padding:13px 16px;display:flex;gap:12px;align-items:flex-start;box-shadow:var(--sh);transition:all .2s;cursor:pointer;}
.nli:hover{border-color:var(--navy);transform:translateX(3px);}
.nli.unread{border-left:4px solid var(--emas);}
.nli-ico{font-size:1.3rem;flex-shrink:0;margin-top:2px;}
.nli-t{font-size:.82rem;font-weight:600;color:var(--navy);}
.nli-m{font-size:.73rem;color:var(--teks3);margin-top:2px;line-height:1.5;}
.nli-tm{font-size:.65rem;color:var(--teks3);margin-left:auto;white-space:nowrap;flex-shrink:0;}

/* PROFIL */
.pcard{background:#fff;border-radius:13px;border:1px solid var(--border);padding:24px;box-shadow:var(--sh);margin-bottom:16px;}
.ph{display:flex;align-items:center;gap:18px;margin-bottom:22px;}
.pav{width:66px;height:66px;border-radius:50%;background:linear-gradient(135deg,var(--navy),var(--emas));display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:700;color:#fff;flex-shrink:0;}
.ph h2{font-family:"Playfair Display",serif;font-size:1.15rem;color:var(--navy);}
.ph p{font-size:.76rem;color:var(--teks3);margin-top:2px;}
.ph .pbg{display:inline-block;background:var(--navy);color:#fff;font-size:.62rem;padding:3px 10px;border-radius:11px;margin-top:5px;font-weight:600;}
.mfr{display:grid;grid-template-columns:1fr 1fr;gap:11px;}
.pws{height:4px;border-radius:2px;margin-top:5px;background:#E5E7EB;overflow:hidden;}
.pwsf{height:100%;border-radius:2px;transition:width .3s,background .3s;}

/* SETTINGS */
.ss{background:#fff;border-radius:13px;border:1px solid var(--border);overflow:hidden;margin-bottom:16px;box-shadow:var(--sh);}
.ssh{padding:12px 18px;border-bottom:1px solid var(--border);background:#F8FAFC;}
.ssh h3{font-size:.78rem;font-weight:700;color:var(--teks2);text-transform:uppercase;letter-spacing:.8px;}
.ssb{padding:16px 18px;display:flex;flex-direction:column;gap:13px;}
.ssi{display:flex;align-items:center;justify-content:space-between;gap:14px;}
.ssi h4{font-size:.82rem;font-weight:600;color:var(--navy);}
.ssi p{font-size:.7rem;color:var(--teks3);margin-top:2px;}
.tog{width:40px;height:21px;background:#D1D5DB;border-radius:11px;cursor:pointer;position:relative;transition:background .3s;flex-shrink:0;}
.tog.on{background:var(--hijau);}
.tog::after{content:"";position:absolute;width:17px;height:17px;background:#fff;border-radius:50%;top:2px;left:2px;transition:transform .3s;box-shadow:0 1px 4px rgba(0,0,0,.2);}
.tog.on::after{transform:translateX(19px);}

/* TOAST */
.toast{position:fixed;bottom:22px;right:22px;transform:translateY(100px);background:var(--navy);color:#fff;padding:11px 18px;border-radius:9px;font-size:.78rem;font-weight:500;box-shadow:var(--sh2);z-index:9999;transition:transform .35s cubic-bezier(.34,1.56,.64,1);pointer-events:none;border-left:4px solid var(--emas2);max-width:280px;}
.toast.show{transform:translateY(0);}
.toast.ok{border-left-color:var(--hijau);}
.toast.er{border-left-color:var(--merah);}
.toast.wn{border-left-color:var(--emas);}
.spin{width:13px;height:13px;border-radius:50%;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;animation:spin .7s linear infinite;display:inline-block;vertical-align:middle;}
@keyframes spin{to{transform:rotate(360deg)}}
.stit{font-family:"Playfair Display",serif;font-size:1rem;color:var(--navy);margin-bottom:14px;font-weight:700;}
.empty{text-align:center;padding:44px 20px;color:var(--teks3);}
.empty .ei{font-size:2.5rem;margin-bottom:10px;opacity:.4;}

@media(max-width:1100px){.sg{grid-template-columns:repeat(3,1fr);}}
@media(max-width:820px){.sg{grid-template-columns:repeat(2,1fr);}.gr.g31,.gr.g22{grid-template-columns:1fr;}.sidebar{transform:translateX(-100%);}.main{margin-left:0;}.dr{grid-template-columns:1fr;}.mfr{grid-template-columns:1fr;}}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="lw">
    <div class="ll">
      <div class="ll-badge">&#9878;</div>
      <h1>Panel Administrasi<br>Inspektorat Daerah</h1>
      <p>Kabupaten Tanjung Jabung Timur<br>Sistem Manajemen Pengaduan Masyarakat Digital</p>
      <div class="ll-feats">
        <div class="lf"><div class="lf-dot"></div>Dashboard &amp; Grafik Analitik Laporan</div>
        <div class="lf"><div class="lf-dot"></div>Kelola &amp; Update Status Pengaduan</div>
        <div class="lf"><div class="lf-dot"></div>Export Data CSV Spreadsheet</div>
        <div class="lf"><div class="lf-dot"></div>Notifikasi Laporan Baru Otomatis</div>
        <div class="lf"><div class="lf-dot"></div>Manajemen Akun &amp; Keamanan</div>
      </div>
    </div>
    <div class="lr">
      <h2>Selamat Datang</h2>
      <div class="lr-sub">Masuk dengan akun administrator sistem</div>
      <div id="lform">
        <div class="fg"><label>Username</label><div class="fw"><span class="fi">&#128100;</span><input type="text" id="luser" placeholder="Masukkan username" autocomplete="username"/></div></div>
        <div class="fg"><label>Password</label><div class="fw"><span class="fi">&#128274;</span><input type="password" id="lpass" placeholder="Masukkan password" autocomplete="current-password"/><span class="fe" id="leye" onclick="togPw()">&#128065;</span></div></div>
        <div class="frem"><input type="checkbox" id="lrem"/><label for="lrem">Ingat saya di perangkat ini</label></div>
        <button class="lbtn" id="lbtn" onclick="doLogin()">&#128272; &nbsp;Masuk ke Panel Admin</button>
        <div class="lerr" id="lerr">&#10060; Username atau password salah.</div>
        <div class="lattempt" id="lattempt"></div>
      </div>
      <div class="llock" id="llock">
        <div class="lic">&#128274;</div>
        <h3>Akun Terkunci Sementara</h3>
        <p style="font-size:.76rem;color:var(--teks3)">Terlalu banyak percobaan login gagal</p>
        <div class="ltimer" id="ltimer">0:30</div>
        <p style="font-size:.7rem;color:var(--teks3)">Coba kembali setelah hitungan mundur selesai</p>
      </div>
      <div class="ldiv"></div>
      <div class="lhint">Hubungi administrator jika lupa password</div>
    </div>
  </div>
</div>

<!-- ADMIN APP -->
<div id="adminApp">
  <div class="sidebar">
    <div class="sl">
      <div class="sl-ico">&#9878;</div>
      <div><h2>Inspektorat<br>Tanjab Timur</h2><p>Admin Panel</p></div>
    </div>
    <nav class="snav">
      <div class="nsec">Menu Utama</div>
      <div class="ni active" onclick="goPanel('dashboard',this)"><span class="nico">&#128202;</span>Dashboard</div>
      <div class="ni" onclick="goPanel('laporan',this)"><span class="nico">&#128203;</span>Semua Laporan<span class="nb" id="nb-total">0</span></div>
      <div class="nsec">Filter Status</div>
      <div class="ni" onclick="filterGo('Diterima',this)"><span class="nico">&#128232;</span>Diterima<span class="nb o" id="nb-diterima">0</span></div>
      <div class="ni" onclick="filterGo('Diproses',this)"><span class="nico">&#9881;</span>Diproses<span class="nb b" id="nb-proses">0</span></div>
      <div class="ni" onclick="filterGo('Investigasi',this)"><span class="nico">&#128270;</span>Investigasi<span class="nb" style="background:var(--ungu)" id="nb-invest">0</span></div>
      <div class="ni" onclick="filterGo('Selesai',this)"><span class="nico">&#9989;</span>Selesai<span class="nb g" id="nb-selesai">0</span></div>
      <div class="nsec">Lainnya</div>
      <div class="ni" onclick="goPanel('notifikasi',this)"><span class="nico">&#128276;</span>Notifikasi<span class="nb" id="nb-notif">0</span></div>
      <div class="ni" onclick="goPanel('profil',this)"><span class="nico">&#128100;</span>Profil Saya</div>
      <div class="ni" onclick="goPanel('pengaturan',this)"><span class="nico">&#9881;</span>Pengaturan</div>
    </nav>
    <div class="sfoot">
      <div class="uc">
        <div class="uav" id="uav">A</div>
        <div><div class="un" id="unam">Admin</div><div class="ur" id="urol">Administrator</div></div>
        <div class="uout" onclick="doLogout()" title="Keluar">&#9211;</div>
      </div>
    </div>
  </div>

  <div class="main">
    <div class="topbar">
      <div class="tbl" id="ptitle">Dashboard</div>
      <div class="tbr">
        <div class="tbdate" id="tbdate"></div>
        <div class="tbnotif" onclick="goPanel('notifikasi',null)">&#128276;<div class="ndot" id="ndot" style="display:none"></div></div>
        <button class="tbbtn green" onclick="exportCSV()">&#11015; Export CSV</button>
        <button class="tbbtn navy" onclick="loadData()">&#8635; Refresh</button>
      </div>
    </div>

    <div class="content">

      <!-- DASHBOARD -->
      <div class="panel active" id="panel-dashboard">
        <div class="sg">
          <div class="sc c1"><span class="sc-ico">&#128203;</span><div class="sc-val" id="sv-tot">0</div><div class="sc-lbl">Total Laporan</div><div class="sc-sub" id="ss-tot">‚Äî</div></div>
          <div class="sc c2"><span class="sc-ico">&#128232;</span><div class="sc-val" id="sv-dit">0</div><div class="sc-lbl">Diterima</div><div class="sc-sub">Menunggu verifikasi</div></div>
          <div class="sc c3"><span class="sc-ico">&#9881;</span><div class="sc-val" id="sv-pro">0</div><div class="sc-lbl">Diproses</div><div class="sc-sub">Sedang ditangani</div></div>
          <div class="sc c4"><span class="sc-ico">&#128270;</span><div class="sc-val" id="sv-inv">0</div><div class="sc-lbl">Investigasi</div><div class="sc-sub">Di lapangan</div></div>
          <div class="sc c5"><span class="sc-ico">&#9989;</span><div class="sc-val" id="sv-sel">0</div><div class="sc-lbl">Selesai</div><div class="sc-sub" id="ss-sel">‚Äî</div></div>
          <div class="sc c6"><span class="sc-ico">&#10060;</span><div class="sc-val" id="sv-dit2">0</div><div class="sc-lbl">Ditolak</div><div class="sc-sub">Tidak memenuhi syarat</div></div>
        </div>

        <!-- Tren + Donut -->
        <div class="gr g31">
          <div class="gc">
            <div class="gch"><h4>&#128200; Tren Laporan Masuk (6 Bulan)</h4><span class="gt">2026</span></div>
            <canvas id="cLine" height="140"></canvas>
          </div>
          <div class="gc">
            <div class="gch"><h4>&#129361; Distribusi Status</h4><span class="gt" id="gt-stat">‚Äî</span></div>
            <div class="dw">
              <canvas id="cDonut" width="130" height="130"></canvas>
              <div class="dleg" id="dleg"></div>
            </div>
          </div>
        </div>

        <!-- Bar kategori + instansi -->
        <div class="gr g22">
          <div class="gc">
            <div class="gch"><h4>&#128202; Laporan per Kategori</h4><span class="gt" id="gt-kat">‚Äî</span></div>
            <div class="hbl" id="hb-kat"></div>
          </div>
          <div class="gc">
            <div class="gch"><h4>&#127963; Laporan per Instansi</h4><span class="gt" id="gt-inst">‚Äî</span></div>
            <div class="hbl" id="hb-inst"></div>
          </div>
        </div>

        <!-- Bar bulanan + quick stats -->
        <div class="gr g22">
          <div class="gc">
            <div class="gch"><h4>&#128197; Volume per Bulan</h4><span class="gt">Tahun 2026</span></div>
            <div class="bvw" id="bv-bln"></div>
          </div>
          <div class="gc">
            <div class="gch"><h4>&#9889; Ringkasan Cepat</h4></div>
            <div class="qs" id="qs-box"></div>
          </div>
        </div>

        <!-- Laporan terbaru -->
        <div class="tc">
          <div class="tch"><h3>&#128336; Laporan Terbaru</h3><button class="tbbtn navy" style="font-size:.72rem;padding:5px 12px" onclick="goPanel('laporan',null)">Lihat Semua &#8594;</button></div>
          <div class="tw"><table><thead><tr><th>Kode</th><th>Waktu</th><th>Kategori</th><th>Instansi</th><th>Status</th><th>Aksi</th></tr></thead>
          <tbody id="tb-new"></tbody></table></div>
        </div>
      </div>

      <!-- LAPORAN -->
      <div class="panel" id="panel-laporan">
        <div class="tc">
          <div class="tch"><h3>&#128203; Daftar Semua Laporan</h3>
            <div class="tcc">
              <div class="fc-w"><input class="fci" id="fc-cari" placeholder="Cari kode/nama..." oninput="renderT()"/></div>
              <select class="fcs" id="fc-stat" onchange="renderT()"><option value="">Semua Status</option><option>Diterima</option><option>Diverifikasi</option><option>Diproses</option><option>Investigasi</option><option>Selesai</option><option>Ditolak</option></select>
              <select class="fcs" id="fc-kat" onchange="renderT()"><option value="">Semua Kategori</option></select>
              <select class="fcs" id="fc-inst" onchange="renderT()"><option value="">Semua Instansi</option></select>
            </div>
          </div>
          <div class="tw"><table>
            <thead><tr><th>No</th><th class="srt" onclick="srt('kode')">Kode &#8597;</th><th class="srt" onclick="srt('waktu')">Waktu &#8597;</th><th>Pelapor</th><th>Kategori</th><th>Instansi</th><th class="srt" onclick="srt('status')">Status &#8597;</th><th>Aksi</th></tr></thead>
            <tbody id="tb-lap"></tbody>
          </table></div>
          <div class="pg"><div id="pg-info">‚Äî</div><div class="pgb" id="pg-btns"></div></div>
        </div>
      </div>

      <!-- NOTIFIKASI -->
      <div class="panel" id="panel-notifikasi">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div class="stit">&#128276; Notifikasi</div>
          <button class="tbbtn navy" style="font-size:.72rem;padding:5px 12px" onclick="readAll()">&#10003; Tandai Semua Dibaca</button>
        </div>
        <div class="nl" id="nl-box"></div>
      </div>

      <!-- PROFIL -->
      <div class="panel" id="panel-profil">
        <div class="stit">&#128100; Profil Saya</div>
        <div class="pcard">
          <div class="ph">
            <div class="pav" id="pav">A</div>
            <div><h2 id="p-nama">Admin</h2><p id="p-user">@admin</p><span class="pbg" id="p-role">Administrator</span></div>
          </div>
          <div class="mfr">
            <div class="mfg"><label>Nama Lengkap</label><input type="text" id="pf-nama" placeholder="Nama lengkap"/></div>
            <div class="mfg"><label>Username</label><input type="text" id="pf-user" readonly style="background:#F8FAFC;cursor:not-allowed"/></div>
          </div>
          <div class="mfr">
            <div class="mfg"><label>Email</label><input type="email" id="pf-email" placeholder="email@contoh.com"/></div>
            <div class="mfg"><label>No. HP</label><input type="tel" id="pf-hp" placeholder="08xxxxxxxxxx"/></div>
          </div>
          <button class="mbtn pr" onclick="saveProfil()">&#128190; Simpan Profil</button>
        </div>
        <div class="pcard">
          <h3 style="font-size:.86rem;font-weight:700;color:var(--navy);margin-bottom:16px;">&#128273; Ganti Password</h3>
          <div class="mfg"><label>Password Lama</label><input type="password" id="pw-lama" placeholder="Password saat ini"/></div>
          <div class="mfg"><label>Password Baru</label><input type="password" id="pw-baru" placeholder="Minimal 8 karakter" oninput="pwStr(this.value)"/><div class="pws"><div class="pwsf" id="pw-bar" style="width:0%"></div></div></div>
          <div class="mfg"><label>Konfirmasi Password</label><input type="password" id="pw-kon" placeholder="Ulangi password baru"/></div>
          <button class="mbtn pr" onclick="gantiPw()">&#128272; Ganti Password</button>
        </div>
      </div>

      <!-- PENGATURAN -->
      <div class="panel" id="panel-pengaturan">
        <div class="stit">&#9881; Pengaturan Sistem</div>
        <div class="ss"><div class="ssh"><h3>Notifikasi</h3></div><div class="ssb">
          <div class="ssi"><div class="ssi-info"><h4>Notifikasi Laporan Baru</h4><p>Tampilkan pemberitahuan ketika laporan baru masuk</p></div><div class="tog on" onclick="this.classList.toggle('on')"></div></div>
          <div class="ssi"><div class="ssi-info"><h4>Email Harian ke Admin</h4><p>Kirim ringkasan laporan setiap hari ke email admin</p></div><div class="tog" onclick="this.classList.toggle('on')"></div></div>
        </div></div>
        <div class="ss"><div class="ssh"><h3>Tampilan</h3></div><div class="ssb">
          <div class="ssi"><div class="ssi-info"><h4>Auto Refresh Data</h4><p>Refresh data otomatis setiap 5 menit</p></div><div class="tog on" onclick="this.classList.toggle('on')"></div></div>
          <div class="ssi"><div class="ssi-info"><h4>Animasi Grafik</h4><p>Tampilkan animasi saat memuat grafik</p></div><div class="tog on" onclick="this.classList.toggle('on')"></div></div>
        </div></div>
        <div class="ss"><div class="ssh"><h3>Keamanan</h3></div><div class="ssb">
          <div class="ssi"><div class="ssi-info"><h4>Auto Logout (30 menit)</h4><p>Keluar otomatis jika tidak aktif selama 30 menit</p></div><div class="tog on" onclick="this.classList.toggle('on')"></div></div>
          <div class="ssi"><div class="ssi-info"><h4>Log Aktivitas Admin</h4><p>Catat semua aktivitas admin ke spreadsheet</p></div><div class="tog on" onclick="this.classList.toggle('on')"></div></div>
          <div class="ssi"><div class="ssi-info"><h4>Kelola Akun Petugas</h4><p>Lihat daftar akun yang dapat mengakses panel ini</p></div><button class="mbtn pr" onclick="openOv('ov-akun')">Kelola</button></div>
        </div></div>
        <div class="ss"><div class="ssh"><h3>Konfigurasi API</h3></div><div class="ssb">
          <div class="ssi"><div class="ssi-info"><h4>URL Google Apps Script</h4><p>Endpoint API untuk koneksi ke Google Spreadsheet</p></div><button class="mbtn pr" onclick="openOv('ov-api')">Konfigurasi</button></div>
        </div></div>
      </div>

    </div>
  </div>
</div>

<!-- MODAL DETAIL -->
<div class="ov" id="ov-det"><div class="mod lg">
  <div class="mh"><div><h3>&#128203; Detail Laporan</h3><div class="mh-sub" id="md-sub"></div></div><span class="mhx" onclick="closeOv('ov-det')">&#x2715;</span></div>
  <div class="mb" id="md-body"></div>
  <div class="mf"><button class="mbtn ca" onclick="closeOv('ov-det')">Tutup</button><button class="mbtn su" onclick="cetakDet()">&#128424; Cetak</button><button class="mbtn pr" onclick="detToUpd()">&#9881; Update Status</button></div>
</div></div>

<!-- MODAL UPDATE -->
<div class="ov" id="ov-upd"><div class="mod md">
  <div class="mh"><h3>&#9881; Update Status Laporan</h3><span class="mhx" onclick="closeOv('ov-upd')">&#x2715;</span></div>
  <div class="mb">
    <div style="background:#F7F9FC;border-radius:8px;padding:9px 13px;margin-bottom:14px;font-size:.8rem;color:var(--navy);font-weight:600" id="upd-info"></div>
    <div class="mfg"><label>Status Baru</label>
      <select id="upd-stat"><option value="Diterima">&#128232; Diterima</option><option value="Diverifikasi">&#128269; Diverifikasi</option><option value="Diproses">&#9881; Diproses</option><option value="Investigasi">&#128270; Investigasi</option><option value="Selesai">&#9989; Selesai</option><option value="Ditolak">&#10060; Ditolak</option></select>
    </div>
    <div class="mfg"><label>Catatan Petugas</label><textarea id="upd-cat" placeholder="Tulis catatan tindak lanjut..."></textarea></div>
  </div>
  <div class="mf"><button class="mbtn ca" onclick="closeOv('ov-upd')">Batal</button><button class="mbtn pr" id="btn-save" onclick="simpanUpd()">&#128190; Simpan</button></div>
</div></div>

<!-- MODAL HAPUS -->
<div class="ov" id="ov-hps"><div class="mod sm">
  <div class="mh"><h3>&#9888; Konfirmasi Hapus</h3><span class="mhx" onclick="closeOv('ov-hps')">&#x2715;</span></div>
  <div class="mb"><p style="font-size:.86rem;line-height:1.7">Apakah Anda yakin menghapus laporan <strong id="hps-kode"></strong>? Tindakan ini <strong style="color:var(--merah)">tidak dapat dibatalkan</strong>.</p></div>
  <div class="mf"><button class="mbtn ca" onclick="closeOv('ov-hps')">Batal</button><button class="mbtn da" onclick="eksekusiHapus()">&#128465; Ya, Hapus</button></div>
</div></div>

<!-- MODAL AKUN -->
<div class="ov" id="ov-akun"><div class="mod md">
  <div class="mh"><h3>&#128101; Kelola Akun Petugas</h3><span class="mhx" onclick="closeOv('ov-akun')">&#x2715;</span></div>
  <div class="mb" id="akun-body"></div>
  <div class="mf"><button class="mbtn ca" onclick="closeOv('ov-akun')">Tutup</button></div>
</div></div>

<!-- MODAL API -->
<div class="ov" id="ov-api"><div class="mod sm">
  <div class="mh"><h3>&#128279; Konfigurasi API</h3><span class="mhx" onclick="closeOv('ov-api')">&#x2715;</span></div>
  <div class="mb"><div class="mfg"><label>URL Google Apps Script</label><input type="text" id="api-url" style="font-size:.72rem;font-family:monospace"/></div></div>
  <div class="mf"><button class="mbtn ca" onclick="closeOv('ov-api')">Batal</button><button class="mbtn pr" onclick="simpanAPI()">&#128190; Simpan</button></div>
</div></div>

<div class="toast" id="toast"></div>

<script>
// CONFIG
let SCRIPT_URL="https://script.google.com/macros/s/AKfycbxLLWp-q0txxo2wHtzENorKPDoUrQ-YsZ4CXKl6RmTFsFrLWMf1DsTbA6kIPSKvGJMi/exec";
let ACCOUNTS=[
  {username:"admin",    password:"inspektorat2026",nama:"Administrator",   role:"Administrator"},
  {username:"petugas1", password:"petugas123",     nama:"Budi Kusuma",     role:"Petugas"},
  {username:"petugas2", password:"petugas456",     nama:"Siti Rahayu",     role:"Petugas"},
];

// STATE
let DATA=[],aktifKode=null,aktifAdmin=null;
let sortF="waktu",sortA=false,pgCur=1;
const PGS=15;
let attempts=0,lockUntil=0,lockInt=null;
let notifs=[],autoRef=null,autoLogT=null;
let charts={};

// ---- LOGIN ----
function togPw(){const i=document.getElementById("lpass"),e=document.getElementById("leye");i.type=i.type==="password"?"text":"password";e.innerHTML=i.type==="password"?"&#128065;":"&#128584;";}

function doLogin(){
  if(Date.now()<lockUntil)return;
  const u=document.getElementById("luser").value.trim(),p=document.getElementById("lpass").value;
  const f=ACCOUNTS.find(a=>a.username===u&&a.password===p);
  if(f){attempts=0;aktifAdmin=f;if(document.getElementById("lrem").checked)localStorage.setItem("adm_s",JSON.stringify({u,ts:Date.now()}));startAdmin();}
  else{
    attempts++;
    const e=document.getElementById("lerr");e.classList.add("show");setTimeout(()=>e.classList.remove("show"),3000);
    if(attempts>=3){const aw=document.getElementById("lattempt");aw.textContent="&#9888; "+(5-attempts)+" percobaan tersisa sebelum dikunci";aw.classList.add("show");}
    if(attempts>=5)doLock();
  }
}

function doLock(){
  lockUntil=Date.now()+30000;
  document.getElementById("lform").style.opacity=".3";
  document.getElementById("llock").classList.add("show");
  document.getElementById("lbtn").disabled=true;
  lockInt=setInterval(()=>{
    const s=Math.max(0,Math.ceil((lockUntil-Date.now())/1000));
    document.getElementById("ltimer").textContent="0:"+String(s).padStart(2,"0");
    if(s<=0){clearInterval(lockInt);attempts=0;document.getElementById("lform").style.opacity="1";document.getElementById("llock").classList.remove("show");document.getElementById("lbtn").disabled=false;document.getElementById("lattempt").classList.remove("show");}
  },500);
}

function startAdmin(){
  document.getElementById("loginPage").style.display="none";
  document.getElementById("adminApp").classList.add("show");
  ["uav","pav"].forEach(id=>{document.getElementById(id).textContent=aktifAdmin.nama[0].toUpperCase();});
  document.getElementById("unam").textContent=aktifAdmin.nama;
  document.getElementById("urol").textContent=aktifAdmin.role;
  document.getElementById("p-nama").textContent=aktifAdmin.nama;
  document.getElementById("p-user").textContent="@"+aktifAdmin.username;
  document.getElementById("p-role").textContent=aktifAdmin.role;
  document.getElementById("pf-nama").value=aktifAdmin.nama;
  document.getElementById("pf-user").value=aktifAdmin.username;
  document.getElementById("api-url").value=SCRIPT_URL;
  updateDate();loadData();buildNotifs();
  document.addEventListener("mousemove",resetAL);document.addEventListener("keypress",resetAL);
  startAL();
}

function doLogout(){
  clearTimeout(autoLogT);clearInterval(autoRef);localStorage.removeItem("adm_s");
  aktifAdmin=null;DATA=[];
  // destroy charts
  Object.values(charts).forEach(c=>{try{c.destroy();}catch(e){}});charts={};
  document.getElementById("adminApp").classList.remove("show");
  document.getElementById("loginPage").style.display="flex";
  document.getElementById("lpass").value="";
  showT("&#128075; Berhasil keluar","ok");
}

let alTimer;
function startAL(){alTimer=setTimeout(()=>{showT("&#8987; Sesi berakhir ‚Äî tidak aktif","wn");setTimeout(doLogout,2500);},30*60*1000);}
function resetAL(){clearTimeout(alTimer);startAL();}

// ---- PANEL ----
function goPanel(id,el){
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  document.querySelectorAll(".ni").forEach(n=>n.classList.remove("active"));
  document.getElementById("panel-"+id).classList.add("active");
  if(el)el.classList.add("active");
  const titles={dashboard:"Dashboard",laporan:"Semua Laporan",notifikasi:"Notifikasi",profil:"Profil Saya",pengaturan:"Pengaturan"};
  document.getElementById("ptitle").textContent=titles[id]||id;
  if(id==="laporan")renderT();
  if(id==="notifikasi")renderNotifs();
}
function filterGo(s,el){goPanel("laporan",el);document.getElementById("fc-stat").value=s;renderT();}

// ---- LOAD DATA ----
function loadData(){
  showT("&#8635; Memuat data...","");
  const old=document.getElementById("_jl");if(old)old.remove();
  window._cb=function(j){
    if(j&&j.data&&j.data.length>0){DATA=j.data;afterLoad();}
    else loadDemo();
  };
  const s=document.createElement("script");s.id="_jl";
  s.src=SCRIPT_URL+"?action=getAllLaporan&callback=_cb&t="+Date.now();
  document.head.appendChild(s);
  setTimeout(()=>{if(!DATA.length)loadDemo();},5000);
}

function loadDemo(){
  DATA=[
    {no:1,kode:"LP-2026-A3B2",waktu:"21/02/2026 08:15",status:"Diterima",nama:"Ahmad Fauzi",nik:"1502011234560001",telepon:"081234567890",email:"ahmad@gmail.com",alamat:"Desa Rantau Rasau, Kec. Rantau Rasau",pekerjaan:"Petani",hubungan:"Masyarakat Umum",kategori:"Pungutan Liar (Pungli)",instansi:"Kecamatan",terlapor:"Oknum A",jabatan_terlapor:"Staf",tgl_kejadian:"2026-02-18",lokasi:"Kantor Kecamatan Rantau Rasau",kronologi:"Diminta membayar untuk surat domisili yang seharusnya gratis.",kerugian:"Rp 150.000",jumlah_bukti:2,catatan:""},
    {no:2,kode:"LP-2026-C7D4",waktu:"20/02/2026 14:30",status:"Diproses",nama:"Siti Rahayu",nik:"1502010202020002",telepon:"082345678901",email:"-",alamat:"Muara Sabak Barat",pekerjaan:"Guru",hubungan:"ASN / Pegawai Pemerintah",kategori:"Korupsi / Gratifikasi",instansi:"Dinas PUPR",terlapor:"Budi Santoso",jabatan_terlapor:"Kepala Bidang",tgl_kejadian:"2026-02-10",lokasi:"Kantor Dinas PUPR",kronologi:"Mark-up anggaran proyek jalan senilai Rp 250 juta.",kerugian:"Rp 250.000.000",jumlah_bukti:5,catatan:"Sedang investigasi lapangan"},
    {no:3,kode:"LP-2026-E5F1",waktu:"19/02/2026 09:45",status:"Selesai",nama:"Hendra Wijaya",nik:"1502010303030003",telepon:"083456789012",email:"hendra@yahoo.com",alamat:"Nipah Panjang",pekerjaan:"Wiraswasta",hubungan:"Masyarakat Umum",kategori:"Pelanggaran Disiplin ASN",instansi:"Dinas Pendidikan",terlapor:"Oknum B",jabatan_terlapor:"Guru SDN",tgl_kejadian:"2026-01-20",lokasi:"SDN 01 Muara Sabak",kronologi:"ASN tidak hadir 14 hari tanpa keterangan.",kerugian:"-",jumlah_bukti:3,catatan:"Sanksi disiplin tingkat sedang diberikan"},
    {no:4,kode:"LP-2026-G9H3",waktu:"18/02/2026 11:20",status:"Investigasi",nama:"Dewi Lestari",nik:"1502010404040004",telepon:"084567890123",email:"-",alamat:"Sungai Lokan",pekerjaan:"Ibu Rumah Tangga",hubungan:"Masyarakat Umum",kategori:"Penggelapan Aset Daerah",instansi:"BPKAD",terlapor:"Oknum C",jabatan_terlapor:"Bendahara Aset",tgl_kejadian:"2026-01-25",lokasi:"Kantor BPKAD",kronologi:"Kendaraan dinas digunakan untuk keperluan pribadi.",kerugian:"Rp 50.000.000",jumlah_bukti:4,catatan:"Mengumpulkan bukti tambahan"},
    {no:5,kode:"LP-2026-J2K8",waktu:"17/02/2026 16:00",status:"Ditolak",nama:"Rizal Perdana",nik:"1502010505050005",telepon:"085678901234",email:"-",alamat:"Kampung Laut",pekerjaan:"Nelayan",hubungan:"Masyarakat Umum",kategori:"Lainnya",instansi:"Kelurahan / Desa",terlapor:"-",jabatan_terlapor:"-",tgl_kejadian:"2026-01-10",lokasi:"Desa Kampung Laut",kronologi:"Sengketa batas tanah, bukan kewenangan Inspektorat.",kerugian:"-",jumlah_bukti:0,catatan:"Ditolak ‚Äî diarahkan ke BPN"},
    {no:6,kode:"LP-2026-L4M6",waktu:"15/02/2026 10:00",status:"Diverifikasi",nama:"Tarigan Manurung",nik:"1502010606060006",telepon:"086789012345",email:"-",alamat:"Muara Sabak Timur",pekerjaan:"Kontraktor",hubungan:"Rekanan / Penyedia Jasa",kategori:"Kecurangan Proses Tender",instansi:"UKPBJ / Bagian Pengadaan",terlapor:"Oknum D",jabatan_terlapor:"Pokja ULP",tgl_kejadian:"2026-02-01",lokasi:"Kantor UKPBJ",kronologi:"Dugaan persekongkolan tender mebel kantor Rp 800 juta.",kerugian:"Rp 800.000.000",jumlah_bukti:6,catatan:"Dokumen diverifikasi"},
    {no:7,kode:"LP-2026-N8P2",waktu:"12/02/2026 13:30",status:"Diterima",nama:"Yuliana Putri",nik:"1502010707070007",telepon:"087890123456",email:"yuli@gmail.com",alamat:"Berbak",pekerjaan:"Bidan",hubungan:"ASN / Pegawai Pemerintah",kategori:"Penyalahgunaan Wewenang",instansi:"Dinas Kesehatan",terlapor:"Oknum E",jabatan_terlapor:"Kepala Puskesmas",tgl_kejadian:"2026-02-08",lokasi:"Puskesmas Berbak",kronologi:"Memungut iuran tidak resmi kepada pasien BPJS.",kerugian:"Rp 25.000.000",jumlah_bukti:2,catatan:""},
  ];
  afterLoad();showT("&#8505; Mode demo aktif","wn");
}

function afterLoad(){
  renderDash();renderT();updateBadges();populateFilters();
  showT("&#9989; Data dimuat ("+DATA.length+" laporan)","ok");
  clearInterval(autoRef);autoRef=setInterval(loadData,5*60*1000);
}

// ---- DASHBOARD ----
function renderDash(){
  const tot=DATA.length;
  const dit=DATA.filter(d=>d.status==="Diterima").length;
  const pro=DATA.filter(d=>d.status==="Diproses"||d.status==="Diverifikasi").length;
  const inv=DATA.filter(d=>d.status==="Investigasi").length;
  const sel=DATA.filter(d=>d.status==="Selesai").length;
  const tol=DATA.filter(d=>d.status==="Ditolak").length;
  const animN=(id,v)=>{let c=0;const s=Math.max(1,Math.floor(v/20));const t=setInterval(()=>{c=Math.min(c+s,v);document.getElementById(id).textContent=c;if(c>=v)clearInterval(t);},40);};
  animN("sv-tot",tot);animN("sv-dit",dit);animN("sv-pro",pro);animN("sv-inv",inv);animN("sv-sel",sel);animN("sv-dit2",tol);
  document.getElementById("ss-tot").textContent=tot+" laporan masuk";
  document.getElementById("ss-sel").textContent=tot>0?Math.round(sel/tot*100)+"% tingkat penyelesaian":"‚Äî";

  buildDonut([
    {l:"Diterima",v:dit,c:"#D97706"},{l:"Diproses",v:pro,c:"#2563EB"},
    {l:"Investigasi",v:inv,c:"#7C3AED"},{l:"Selesai",v:sel,c:"#16A34A"},{l:"Ditolak",v:tol,c:"#C0392B"}
  ],tot);
  buildHBar("hb-kat",hitungPer("kategori"),7,"gt-kat");
  buildHBar("hb-inst",hitungPer("instansi"),6,"gt-inst");
  buildBarBln();
  buildLine();
  buildQS(tot,sel,dit,pro);
  buildTerbaru();
}

function hitungPer(f){const m={};DATA.forEach(d=>{const k=d[f]||"-";m[k]=(m[k]||0)+1;});return Object.entries(m).sort((a,b)=>b[1]-a[1]);}

// DONUT (Chart.js)
function buildDonut(segs,tot){
  if(charts.donut){charts.donut.destroy();}
  const vs=segs.filter(s=>s.v>0);
  const ctx=document.getElementById("cDonut").getContext("2d");
  charts.donut=new Chart(ctx,{type:"doughnut",data:{labels:vs.map(s=>s.l),datasets:[{data:vs.map(s=>s.v),backgroundColor:vs.map(s=>s.c),borderWidth:2,borderColor:"#fff",hoverOffset:6}]},options:{cutout:"65%",plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>ctx.label+": "+ctx.raw+" ("+Math.round(ctx.raw/tot*100)+"%)"}}},animation:{duration:800}}});
  document.getElementById("gt-stat").textContent=tot+" total";
  document.getElementById("dleg").innerHTML=vs.map(s=>`<div class="dli"><div class="dld" style="background:${s.c}"></div><span class="dll">${s.l}</span><span class="dlc">${s.v}</span></div>`).join("");
}

// LINE (Chart.js)
function buildLine(){
  if(charts.line){charts.line.destroy();}
  const bln=["Jan","Feb","Mar","Apr","Mei","Jun"];
  const cnt=new Array(6).fill(0);
  DATA.forEach(d=>{const tgl=d.waktu||"";const m=parseInt(tgl.split("/")[1]);if(m>=1&&m<=6)cnt[m-1]++;});
  const ctx=document.getElementById("cLine").getContext("2d");
  const grad=ctx.createLinearGradient(0,0,0,140);grad.addColorStop(0,"rgba(27,58,92,.22)");grad.addColorStop(1,"rgba(27,58,92,.0)");
  charts.line=new Chart(ctx,{type:"line",data:{labels:bln,datasets:[{label:"Laporan",data:cnt,borderColor:"#1B3A5C",backgroundColor:grad,borderWidth:2.5,pointBackgroundColor:"#fff",pointBorderColor:"#1B3A5C",pointBorderWidth:2,pointRadius:5,tension:.35,fill:true}]},options:{plugins:{legend:{display:false},tooltip:{callbacks:{title:([c])=>"Bulan: "+c.label,label:c=>"Laporan: "+c.raw}}},scales:{y:{beginAtZero:true,ticks:{stepSize:1,font:{size:10}},grid:{color:"#F0F3F7"}},x:{ticks:{font:{size:10}},grid:{display:false}}},animation:{duration:900}}});
}

// HBAR
const HBC=["#1B3A5C","#D97706","#2563EB","#16A34A","#7C3AED","#C0392B","#0891B2"];
function buildHBar(id,entries,max,tagId){
  entries=entries.slice(0,max);const mv=entries[0]?.[1]||1;
  document.getElementById(id).innerHTML=entries.map(([k,v],i)=>`
    <div class="hbi">
      <div class="hbl-lbl" title="${k}">${k.length>19?k.slice(0,19)+"‚Ä¶":k}</div>
      <div class="hbt"><div class="hbf" style="width:0%;background:${HBC[i%HBC.length]}" data-w="${(v/mv*100).toFixed(1)}"></div></div>
      <div class="hbc">${v}</div>
    </div>`).join("")||"<div style=\"color:var(--teks3);font-size:.78rem\">Belum ada data</div>";
  setTimeout(()=>document.querySelectorAll("#"+id+" .hbf").forEach(el=>{el.style.width=el.dataset.w+"%";}),100);
  document.getElementById(tagId).textContent=entries.length+" jenis";
}

// BAR BULANAN
function buildBarBln(){
  const bln=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Ags","Sep","Okt","Nov","Des"];
  const cnt=new Array(12).fill(0);
  DATA.forEach(d=>{const tgl=d.waktu||"";const m=parseInt(tgl.split("/")[1]);if(m>=1&&m<=12)cnt[m-1]++;});
  const mv=Math.max(...cnt,1);
  const BVC=["#1B3A5C","#2563EB","#16A34A","#D97706","#7C3AED","#C0392B","#0891B2","#1B3A5C","#D97706","#16A34A","#7C3AED","#C0392B"];
  document.getElementById("bv-bln").innerHTML=cnt.map((v,i)=>`
    <div class="bvi">
      <div class="bvv">${v||""}</div>
      <div class="bvb" style="height:0%;background:${BVC[i]}" data-h="${(v/mv*100).toFixed(1)}" title="${bln[i]}: ${v} laporan"></div>
      <div class="bvl">${bln[i]}</div>
    </div>`).join("");
  setTimeout(()=>document.querySelectorAll(".bvb").forEach(el=>{el.style.height=el.dataset.h+"%";}),100);
}

// QUICK STATS
function buildQS(tot,sel,dit,pro){
  const pct=tot>0?Math.round(sel/tot*100):0;
  const top=hitungPer("kategori")[0]?.[0]||"-";
  const items=[
    {ico:"&#128202;",lbl:"Tingkat Penyelesaian",val:pct+"%",c:"#16A34A"},
    {ico:"&#9203;",lbl:"Menunggu Tindak Lanjut",val:(dit+pro)+" laporan",c:"#D97706"},
    {ico:"&#127942;",lbl:"Kategori Terbanyak",val:top.length>22?top.slice(0,22)+"‚Ä¶":top,c:"#7C3AED"},
    {ico:"&#128197;",lbl:"Avg. Penanganan",val:"~5 hari kerja",c:"#2563EB"},
  ];
  document.getElementById("qs-box").innerHTML=items.map(it=>`
    <div class="qsi" style="border-left:3px solid ${it.c}">
      <span style="font-size:1.2rem">${it.ico}</span>
      <div><div class="qsi-lbl">${it.lbl}</div><div class="qsi-val" style="color:${it.c}">${it.val}</div></div>
    </div>`).join("");
}

// TERBARU
function buildTerbaru(){
  const rows=[...DATA].reverse().slice(0,5);
  document.getElementById("tb-new").innerHTML=rows.map(d=>`<tr>
    <td class="kd">${d.kode}</td><td class="mu">${d.waktu}</td>
    <td style="font-size:.76rem">${d.kategori}</td><td style="font-size:.76rem">${d.instansi}</td>
    <td>${bdg(d.status)}</td>
    <td><button class="ab ab-d" onclick="bukaDetail('${d.kode}')">Detail</button></td>
  </tr>`).join("");
}

// ---- TABEL ----
function renderT(){
  const cr=(document.getElementById("fc-cari")?.value||"").toLowerCase();
  const st=document.getElementById("fc-stat")?.value||"";
  const kt=document.getElementById("fc-kat")?.value||"";
  const ins=document.getElementById("fc-inst")?.value||"";
  let f=DATA.filter(d=>{
    const mc=!cr||(d.kode||"").toLowerCase().includes(cr)||(d.nama||"").toLowerCase().includes(cr)||(d.kategori||"").toLowerCase().includes(cr);
    return mc&&(!st||d.status===st)&&(!kt||d.kategori===kt)&&(!ins||d.instansi===ins);
  });
  f.sort((a,b)=>{const va=a[sortF]||"",vb=b[sortF]||"";return sortA?va.localeCompare(vb):vb.localeCompare(va);});
  const tot=f.length,pgs=Math.ceil(tot/PGS)||1;
  pgCur=Math.min(pgCur,pgs);
  const st2=(pgCur-1)*PGS,en=st2+PGS,pg=f.slice(st2,en);
  document.getElementById("pg-info").textContent=tot>0?"Menampilkan "+(st2+1)+"‚Äì"+Math.min(en,tot)+" dari "+tot:"Tidak ada data";
  let ph="";if(pgs>1){ph+=`<button class="pb" onclick="chPg(${pgCur-1})" ${pgCur<=1?"disabled":""}>&#8249;</button>`;for(let i=1;i<=Math.min(pgs,7);i++)ph+=`<button class="pb ${i===pgCur?"active":""}" onclick="chPg(${i})">${i}</button>`;ph+=`<button class="pb" onclick="chPg(${pgCur+1})" ${pgCur>=pgs?"disabled":""}>&#8250;</button>`;}
  document.getElementById("pg-btns").innerHTML=ph;
  document.getElementById("tb-lap").innerHTML=pg.length
    ?pg.map((d,i)=>`<tr>
      <td class="mu">${st2+i+1}</td><td class="kd">${d.kode}</td>
      <td class="mu">${d.waktu}</td><td style="font-weight:500">${d.nama||"-"}</td>
      <td style="font-size:.74rem">${d.kategori||"-"}</td><td style="font-size:.74rem">${d.instansi||"-"}</td>
      <td>${bdg(d.status)}</td>
      <td style="display:flex;gap:4px;flex-wrap:wrap">
        <button class="ab ab-d" onclick="bukaDetail('${d.kode}')">Detail</button>
        <button class="ab ab-u" onclick="bukaUpd('${d.kode}')">Update</button>
        <button class="ab ab-h" onclick="konfHps('${d.kode}')">Hapus</button>
      </td>
    </tr>`).join("")
    :"<tr><td colspan=\"8\"><div class=\"empty\"><div class=\"ei\">&#128269;</div><p>Tidak ada laporan yang cocok</p></div></td></tr>";
}
function chPg(p){pgCur=p;renderT();}
function srt(f){sortA=sortF===f?!sortA:false;sortF=f;renderT();}

// FILTERS
function populateFilters(){
  ["fc-kat","fc-inst"].forEach(id=>{while(document.getElementById(id).options.length>1)document.getElementById(id).remove(1);});
  [...new Set(DATA.map(d=>d.kategori).filter(Boolean))].forEach(k=>{const o=document.createElement("option");o.textContent=k;document.getElementById("fc-kat").appendChild(o);});
  [...new Set(DATA.map(d=>d.instansi).filter(Boolean))].forEach(k=>{const o=document.createElement("option");o.textContent=k;document.getElementById("fc-inst").appendChild(o);});
}

// BADGE
function bdg(s){const m={Diterima:"bd",Diverifikasi:"bv",Diproses:"bp",Investigasi:"bi",Selesai:"bs",Ditolak:"bt"};return `<span class="badge ${m[s]||"bd"}">${s||"Diterima"}</span>`;}

// BADGES SIDEBAR
function updateBadges(){
  document.getElementById("nb-total").textContent=DATA.length;
  document.getElementById("nb-diterima").textContent=DATA.filter(d=>d.status==="Diterima").length;
  document.getElementById("nb-proses").textContent=DATA.filter(d=>d.status==="Diproses"||d.status==="Diverifikasi").length;
  document.getElementById("nb-invest").textContent=DATA.filter(d=>d.status==="Investigasi").length;
  document.getElementById("nb-selesai").textContent=DATA.filter(d=>d.status==="Selesai").length;
  const u=notifs.filter(n=>!n.read).length;
  document.getElementById("nb-notif").textContent=u;
  document.getElementById("ndot").style.display=u>0?"block":"none";
}

// ---- MODAL DETAIL ----
function bukaDetail(k){
  aktifKode=k;const d=DATA.find(x=>x.kode===k);if(!d)return;
  document.getElementById("md-sub").textContent=k+" ¬∑ "+d.kategori;
  document.getElementById("md-body").innerHTML=`
    <div class="dr"><div class="di"><label>Kode Laporan</label><p style="font-family:monospace;font-weight:700;color:var(--navy)">${d.kode}</p></div><div class="di"><label>Status</label><p>${bdg(d.status)}</p></div></div>
    <div class="dr"><div class="di"><label>Waktu Terima</label><p>${d.waktu||"-"}</p></div><div class="di"><label>Tgl Kejadian</label><p>${d.tgl_kejadian||"-"}</p></div></div>
    <div class="mdiv"></div>
    <div class="dr"><div class="di"><label>Nama Pelapor</label><p>${d.nama||"-"}</p></div><div class="di"><label>No. Telepon</label><p>${d.telepon||"-"}</p></div></div>
    <div class="dr"><div class="di"><label>NIK</label><p>${d.nik||"-"}</p></div><div class="di"><label>Pekerjaan</label><p>${d.pekerjaan||"-"}</p></div></div>
    <div class="dr f"><div class="di"><label>Alamat</label><p>${d.alamat||"-"}</p></div></div>
    <div class="mdiv"></div>
    <div class="dr"><div class="di"><label>Kategori</label><p>${d.kategori||"-"}</p></div><div class="di"><label>Instansi</label><p>${d.instansi||"-"}</p></div></div>
    <div class="dr"><div class="di"><label>Nama Terlapor</label><p>${d.terlapor||"-"}</p></div><div class="di"><label>Lokasi</label><p>${d.lokasi||"-"}</p></div></div>
    <div class="dr"><div class="di"><label>Kerugian</label><p>${d.kerugian||"-"}</p></div><div class="di"><label>Jumlah Bukti</label><p>${d.jumlah_bukti||0} file</p></div></div>
    <div class="dr f"><div class="di"><label>Uraian Kronologi</label><p class="db">${d.kronologi||"-"}</p></div></div>
    ${d.catatan?`<div class="dr f"><div class="di"><label>Catatan Petugas</label><p style="color:var(--navy);font-weight:600;background:#FEF9EE;padding:8px 11px;border-radius:7px">${d.catatan}</p></div></div>`:""}`;
  openOv("ov-det");
}
function detToUpd(){closeOv("ov-det");setTimeout(()=>bukaUpd(aktifKode),200);}

// ---- MODAL UPDATE ----
function bukaUpd(k){
  aktifKode=k;const d=DATA.find(x=>x.kode===k);if(!d)return;
  document.getElementById("upd-info").innerHTML=`Laporan <strong style="font-family:monospace">${k}</strong> &nbsp;¬∑&nbsp; ${d.kategori}`;
  document.getElementById("upd-stat").value=d.status||"Diterima";
  document.getElementById("upd-cat").value=d.catatan||"";
  openOv("ov-upd");
}
async function simpanUpd(){
  const s=document.getElementById("upd-stat").value,c=document.getElementById("upd-cat").value.trim();
  const btn=document.getElementById("btn-save");btn.disabled=true;btn.innerHTML="<span class=\"spin\"></span> Menyimpan...";
  try{
    await fetch(SCRIPT_URL,{method:"POST",mode:"no-cors",body:new URLSearchParams({payload:JSON.stringify({action:"updateStatus",kode:aktifKode,statusBaru:s,catatan:c})})});
    const i=DATA.findIndex(x=>x.kode===aktifKode);if(i!==-1){DATA[i].status=s;DATA[i].catatan=c;}
    closeOv("ov-upd");renderDash();renderT();updateBadges();
    addNotif("&#9989;","Status Diperbarui","Laporan "+aktifKode+" ‚Üí "+s);
    showT("&#9989; Status berhasil diperbarui","ok");
  }catch(e){showT("&#10060; Gagal menyimpan","er");}
  finally{btn.disabled=false;btn.innerHTML="&#128190; Simpan";}
}

// ---- HAPUS ----
function konfHps(k){aktifKode=k;document.getElementById("hps-kode").textContent=k;openOv("ov-hps");}
function eksekusiHapus(){DATA=DATA.filter(d=>d.kode!==aktifKode);closeOv("ov-hps");renderDash();renderT();updateBadges();showT("&#128465; Laporan dihapus (lokal)","wn");}

// ---- CETAK ----
function cetakDet(){
  const d=DATA.find(x=>x.kode===aktifKode);if(!d)return;
  const w=window.open("","_blank","width=760,height=680");
  w.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"/><title>Detail ${d.kode}</title><style>body{font-family:Arial,sans-serif;max-width:700px;margin:32px auto;font-size:13px;color:#111}.kop{text-align:center;border-bottom:3px solid #1B3A5C;padding-bottom:14px;margin-bottom:18px}.kop h2{font-size:14px;color:#1B3A5C}.kop p{font-size:11px;color:#666}.kb{background:#FEF9E7;border:2px solid #D97706;border-radius:6px;padding:11px;text-align:center;margin-bottom:16px}.kd{font-size:20px;font-weight:700;letter-spacing:7px;color:#1B3A5C}table{width:100%;border-collapse:collapse;margin-bottom:14px}th{background:#1B3A5C;color:#fff;padding:7px 11px;text-align:left;font-size:11px}td{padding:7px 11px;border-bottom:1px solid #eee;font-size:12px}td:first-child{font-weight:600;width:35%;color:#1B3A5C}.foot{margin-top:24px;text-align:center;font-size:10px;color:#999;border-top:1px solid #eee;padding-top:9px}@media print{.np{display:none}}</style></head><body>
  <div class="kop"><h2>&#9878; INSPEKTORAT DAERAH ‚Äî KAB. TANJUNG JABUNG TIMUR</h2><p>DETAIL LAPORAN PENGADUAN MASYARAKAT</p></div>
  <div class="kb"><div style="font-size:9px;text-transform:uppercase;letter-spacing:2px;color:#888;margin-bottom:5px">Kode Laporan</div><div class="kd">${d.kode}</div></div>
  <table><tr><th colspan="2">Informasi Laporan</th></tr><tr><td>Status</td><td>${d.status}</td></tr><tr><td>Waktu</td><td>${d.waktu}</td></tr><tr><td>Kategori</td><td>${d.kategori}</td></tr><tr><td>Instansi</td><td>${d.instansi}</td></tr><tr><td>Terlapor</td><td>${d.terlapor}</td></tr><tr><td>Lokasi</td><td>${d.lokasi}</td></tr><tr><td>Kerugian</td><td>${d.kerugian}</td></tr></table>
  <table><tr><th colspan="2">Data Pelapor (Rahasia)</th></tr><tr><td>Nama</td><td>${d.nama}</td></tr><tr><td>NIK</td><td>${d.nik}</td></tr><tr><td>Telepon</td><td>${d.telepon}</td></tr><tr><td>Alamat</td><td>${d.alamat}</td></tr></table>
  <table><tr><th>Uraian Kronologi</th></tr><tr><td>${d.kronologi}</td></tr></table>
  ${d.catatan?`<table><tr><th>Catatan Petugas</th></tr><tr><td>${d.catatan}</td></tr></table>`:""}
  <div class="foot">Dicetak oleh Admin Panel Inspektorat Kab. Tanjung Jabung Timur | ${new Date().toLocaleString("id-ID")}</div>
  <br/><button class="np" onclick="window.print()" style="padding:7px 18px;background:#1B3A5C;color:#fff;border:none;border-radius:6px;cursor:pointer">&#128424; Cetak / PDF</button>
  </body></html>`);w.document.close();
}

// ---- EXPORT CSV ----
function exportCSV(){
  if(!DATA.length){showT("Tidak ada data","er");return;}
  const h=["No","Kode","Waktu","Status","Nama","NIK","Telepon","Kategori","Instansi","Terlapor","Lokasi","Kerugian","Catatan"];
  const r=DATA.map(d=>[d.no,d.kode,d.waktu,d.status,d.nama,d.nik,d.telepon,d.kategori,d.instansi,d.terlapor,d.lokasi,d.kerugian,d.catatan].map(v=>`"${String(v||"").replace(/"/g,"\"")}"`).join(","));
  const csv=[h.join(","),...r].join("\n");
  const blob=new Blob(["\ufeff"+csv],{type:"text/csv;charset=utf-8"});
  const url=URL.createObjectURL(blob);const a=document.createElement("a");
  a.href=url;a.download="laporan_inspektorat_"+new Date().toISOString().slice(0,10)+".csv";a.click();URL.revokeObjectURL(url);
  showT("&#11015; File CSV berhasil diunduh","ok");
}

// ---- NOTIFIKASI ----
function buildNotifs(){
  const baru=DATA.filter(d=>d.status==="Diterima").slice(0,3);
  notifs=[{ico:"&#128202;",t:"Sistem Aktif",m:"Panel dimuat. "+DATA.length+" laporan tersedia.",time:"Baru saja",read:false},
    ...baru.map(d=>({ico:"&#128276;",t:"Laporan Baru",m:d.kode+" ‚Äî "+d.kategori,time:d.waktu,read:false}))];
  updateBadges();
}
function addNotif(ico,t,m){notifs.unshift({ico,t,m,time:"Baru saja",read:false});updateBadges();}
function renderNotifs(){
  document.getElementById("nl-box").innerHTML=notifs.length
    ?notifs.map((n,i)=>`<div class="nli ${n.read?"":"unread"}" onclick="readN(${i})"><div class="nli-ico">${n.ico}</div><div><div class="nli-t">${n.t}</div><div class="nli-m">${n.m}</div></div><div class="nli-tm">${n.time}</div></div>`).join("")
    :"<div class=\"empty\"><div class=\"ei\">&#128276;</div><p>Tidak ada notifikasi</p></div>";
}
function readN(i){notifs[i].read=true;renderNotifs();updateBadges();}
function readAll(){notifs.forEach(n=>n.read=true);renderNotifs();updateBadges();showT("&#10003; Semua dibaca","ok");}

// ---- PROFIL ----
function saveProfil(){
  const n=document.getElementById("pf-nama").value.trim();if(!n){showT("Nama kosong","er");return;}
  aktifAdmin.nama=n;
  ["uav","pav"].forEach(id=>{document.getElementById(id).textContent=n[0].toUpperCase();});
  document.getElementById("unam").textContent=n;document.getElementById("p-nama").textContent=n;
  showT("&#128190; Profil disimpan","ok");
}
function pwStr(v){let s=0;if(v.length>=8)s++;if(v.length>=12)s++;if(/[A-Z]/.test(v))s++;if(/[0-9]/.test(v))s++;if(/[^A-Za-z0-9]/.test(v))s++;const pct=[0,20,40,60,80,100][s];const col=["#EEE","#EF4444","#F59E0B","#F59E0B","#16A34A","#16A34A"][s];const bar=document.getElementById("pw-bar");bar.style.width=pct+"%";bar.style.background=col;}
function gantiPw(){
  const l=document.getElementById("pw-lama").value,b=document.getElementById("pw-baru").value,k=document.getElementById("pw-kon").value;
  const idx=ACCOUNTS.findIndex(a=>a.username===aktifAdmin.username);
  if(ACCOUNTS[idx].password!==l){showT("&#10060; Password lama salah","er");return;}
  if(b.length<8){showT("&#9888; Min 8 karakter","er");return;}
  if(b!==k){showT("&#10060; Konfirmasi tidak cocok","er");return;}
  ACCOUNTS[idx].password=b;aktifAdmin.password=b;
  ["pw-lama","pw-baru","pw-kon"].forEach(id=>{document.getElementById(id).value="";});
  document.getElementById("pw-bar").style.width="0%";
  showT("&#128272; Password berhasil diubah","ok");
}

// ---- PENGATURAN ----
function simpanAPI(){SCRIPT_URL=document.getElementById("api-url").value.trim();closeOv("ov-api");showT("&#128190; URL API disimpan. Klik Refresh.","ok");}
function renderAkun(){
  document.getElementById("akun-body").innerHTML=`
    <table style="width:100%;border-collapse:collapse;font-size:.8rem">
      <thead><tr style="background:#F8FAFC"><th style="padding:8px 12px;text-align:left;border-bottom:2px solid var(--border)">Username</th><th style="padding:8px 12px;text-align:left;border-bottom:2px solid var(--border)">Nama</th><th style="padding:8px 12px;text-align:left;border-bottom:2px solid var(--border)">Role</th></tr></thead>
      <tbody>${ACCOUNTS.map(a=>`<tr style="border-bottom:1px solid var(--border)"><td style="padding:8px 12px;font-family:monospace">${a.username}</td><td style="padding:8px 12px">${a.nama}</td><td style="padding:8px 12px"><span class="badge bp">${a.role}</span></td></tr>`).join("")}</tbody>
    </table>
    <p style="font-size:.7rem;color:var(--teks3);margin-top:10px">&#128161; Tambah/ubah akun: edit array ACCOUNTS di dalam file admin.html</p>`;
}

// ---- OVERLAY ----
function openOv(id){document.getElementById(id).classList.add("show");if(id==="ov-akun")renderAkun();}
function closeOv(id){document.getElementById(id).classList.remove("show");}
document.querySelectorAll(".ov").forEach(o=>o.addEventListener("click",e=>{if(e.target===o)o.classList.remove("show");}));

// ---- TOAST ----
let _t;
function showT(msg,type=""){const t=document.getElementById("toast");t.innerHTML=msg;t.className="toast"+(type?" "+type:"");t.classList.add("show");clearTimeout(_t);_t=setTimeout(()=>t.classList.remove("show"),3500);}

// ---- DATE ----
function updateDate(){document.getElementById("tbdate").textContent=new Date().toLocaleDateString("id-ID",{weekday:"short",year:"numeric",month:"short",day:"numeric"});}

// ---- KEYBOARD ----
document.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&document.getElementById("loginPage").style.display!=="none")doLogin();
  if(e.key==="Escape")document.querySelectorAll(".ov.show").forEach(o=>o.classList.remove("show"));
});
document.getElementById("luser").addEventListener("keydown",e=>{if(e.key==="Enter")document.getElementById("lpass").focus();});
</script>
</body>
</html>